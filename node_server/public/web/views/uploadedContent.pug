extends layout.pug

block append stylesheets
    link(rel="stylesheet" type="text/css" href="/web/css/vendor/color-picker.css")

block content
    - var file;
    - var fileType;

    h1 Uploaded Content
  
    hr
    br
    br

    p Content uploaded here can be displayed within worlds. 2D content can be put up on whiteboards and 3D content can be showed off on loading points.

    br

    form(action='/upload-content' method='post' enctype='multipart/form-data' class='pure-form')

        // Getting valid file types to restrict the file upload form
        - var validFiles = '';

        for fileType of validText
            - validFiles += (fileType + ',');

        for fileType of validImages
            - validFiles += (fileType + ',');

        for fileType of validVideos
            - validFiles += (fileType + ',');

        for fileType of valid3D
            - validFiles += (fileType + ',');

        label Upload new content: 
        input(name='contentFile' type='file' accept=validFiles)
    
        div(style='margin:15 0 25 0').instruction-box

            p(style='margin-bottom:0') The acceptable file forms for 2D content are:
            br

            table.file-formats-table  
                thead 
                    tr 
                        td Text 
                        td Images 
                        td Videos
                        td 3D Models
                tbody
                    tr
                        td
                            ul
                                for fileType of validText
                                    li #{fileType}

                        td 
                            ul
                                for fileType of validImages
                                    li #{fileType}

                        td  
                            ul
                                for fileType of validVideos
                                    li #{fileType}
                        
                        td
                            ul
                                for fileType of valid3D
                                    li #{fileType}

        input(type='submit' value='Upload' class='pure-button pure-button-primary')

    if successMessage
        div(style='margin:20px 0 10px 0')
            i(class='fa-solid fa-circle-check success-icon')
            span.success-message #{successMessage}

    if errorMessage
        div(style='margin:20px 0 10px 0')
            i(class='fa-solid fa-triangle-exclamation error-icon')
            span.error-message #{errorMessage}

    br
    hr

    if content.length > 0

        // Displaying the content the user has uploaded
        table.uploads-table
            tbody
                // Content displayed in rows of 3
                - var numRows = Math.ceil(content.length / 3);
                - for (var i = 0; i < numRows; i++)
                    tr
                        - for (var j = 0; j < 3; j++)

                            - var fileNum = (3 * i) + j
                            
                            // Ensuring that there is still content to display
                            if (fileNum < content.length)

                                // Displaying the content in the appropriate way depending on the file type
                                // 1. Image files
                                // 2. Video files
                                // 3. Text files
                                if content[fileNum].category === 'image'

                                    td
                                        div.file-container
                                            - var url = '/uploads/' + content[fileNum].name;
                                            img(src=url) 
                                            div.file-description-hover
                                                i(class="fa-regular fa-image file-icon")
                                                p #{content[fileNum].displayName}
                                                i(class="fa-solid fa-trash fa-lg delete-file")

                                else if content[fileNum].category === 'video'
                            
                                    td
                                        div.file-container
                                            - var url = '/uploads/' + content[fileNum].name;
                                            video(muted autoplay loop)
                                                source(src=url) 
                                            div.file-description-hover
                                                i(class="fa-solid fa-video file-icon")
                                                p #{content[fileNum].displayName}
                                                i(class="fa-solid fa-trash fa-lg delete-file")

                                else 

                                    td.other-file-type
                                        div.file-container
                                            i(class="fa-regular fa-file file-icon")
                                            p #{content[fileNum].displayName}
                                            div.file-description-hover
                                                i(class="fa-regular fa-file file-icon")
                                                p #{content[fileNum].displayName}
                                                i(class="fa-solid fa-trash fa-lg delete-file")

    else
        br
        p(style='text-align:center') You have no content uploaded